<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OAuth Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-900 flex items-center justify-center text-slate-100">

  <!-- User badge -->
  <div
    id="userBadge"
    class="hidden absolute top-4 right-4 flex items-center gap-3 bg-slate-800 px-4 py-2 rounded-lg shadow"
  >
    <img id="avatar" class="w-8 h-8 rounded-full" />
    <div class="text-sm">
      <div id="name" class="font-medium"></div>
      <div class="text-slate-400 text-xs">Logged in</div>
    </div>
  </div>

  <!-- Card -->
  <div class="w-full max-w-md bg-slate-800 rounded-xl shadow-xl p-8 space-y-6">

    <div class="text-center space-y-2">
      <h1 class="text-2xl font-semibold">Sign in</h1>
      <p class="text-slate-400 text-sm">
        Authenticate using a provider
      </p>
    </div>

    <!-- GitHub -->
    <a
      id="githubBtn"
      href="/oauth/connection/github"
      class="flex items-center justify-center gap-3 w-full rounded-lg bg-slate-100 text-slate-900 font-medium py-3 hover:bg-white transition"
    >
      <!-- GitHub logo -->
      <svg height="20" viewBox="0 0 16 16" width="20" fill="currentColor">
        <path
          d="M8 0C3.58 0 0 3.65 0 8.15c0 3.6 2.29 6.65 5.47 7.73.4.08.55-.18.55-.39
          0-.19-.01-.82-.01-1.49-2.01.38-2.53-.5-2.69-.96-.09-.23-.48-.96-.82-1.15
          -.28-.15-.68-.52-.01-.53.63-.01 1.08.6 1.23.85.72 1.23 1.87.88
          2.33.67.07-.53.28-.88.51-1.08-1.78-.21-3.64-.92-3.64-4.07
          0-.9.31-1.64.82-2.22-.08-.21-.36-1.05.08-2.18
          0 0 .67-.22 2.2.85a7.4 7.4 0 0 1 4 0
          c1.53-1.07 2.2-.85 2.2-.85.44 1.13.16 1.97.08 2.18
          .51.58.82 1.31.82 2.22 0 3.16-1.87 3.86-3.65 4.07
          .29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2
          0 .21.15.47.55.39A8.03 8.03 0 0 0 16 8.15C16 3.65 12.42 0 8 0z"
        />
      </svg>
      <span id="githubText">Continue with GitHub</span>
    </a>

    <!-- Google -->
    <a
      id="googleBtn"
      href="/oauth/connection/google"
      class="flex items-center justify-center gap-3 w-full rounded-lg bg-white text-slate-900 font-medium py-3 hover:bg-slate-100 transition"
    >
      <!-- Google logo (VISIBLE now) -->
      <svg width="20" height="20" viewBox="0 0 48 48">
        <path fill="#EA4335" d="M24 9.5c3.5 0 6.7 1.2 9.2 3.3l6.8-6.8C35.8 2.3 30.3 0 24 0 14.6 0 6.4 5.4 2.5 13.3l7.9 6.1C12.4 13.1 17.7 9.5 24 9.5z"/>
        <path fill="#4285F4" d="M46.5 24.5c0-1.7-.2-3.4-.5-5H24v9.5h12.7c-.6 3.2-2.4 5.9-5.1 7.7l7.8 6c4.6-4.2 7.1-10.4 7.1-18.2z"/>
        <path fill="#FBBC05" d="M10.4 28.9c-.5-1.4-.8-2.9-.8-4.4s.3-3 .8-4.4l-7.9-6.1C.9 16.7 0 20.3 0 24s.9 7.3 2.5 10.1l7.9-5.2z"/>
        <path fill="#34A853" d="M24 48c6.5 0 12-2.1 16-5.8l-7.8-6c-2.2 1.5-5.1 2.4-8.2 2.4-6.3 0-11.6-3.6-14.1-8.9l-7.9 5.2C6.4 42.6 14.6 48 24 48z"/>
      </svg>
      <span id="googleText">Continue with Google</span>
    </a>

    <p class="text-xs text-center text-slate-500">
      OAuth only · No passwords stored
    </p>
  </div>

  <script>
    const userBadge = document.getElementById("userBadge");
    const avatar = document.getElementById("avatar");
    const nameEl = document.getElementById("name");

    const githubBtn = document.getElementById("githubBtn");
    const githubText = document.getElementById("githubText");

    const googleBtn = document.getElementById("googleBtn");
    const googleText = document.getElementById("googleText");

    async function disconnect(provider) {
      await fetch(`/logout/${provider}`, {
        method: "POST",
        credentials: "include",
      });
      location.reload();
    }

    async function loadUser() {
      try {
        const res = await fetch("/api/user", { credentials: "include" });
        if (!res.ok) return; // NOT logged in → no badge

        // LOGGED IN (ANY PROVIDER)
        const user = await res.json();
        userBadge.classList.remove("hidden");
        avatar.src = user.avatar;
        nameEl.textContent = user.name;

        const providers = user.providers || {};

        if (providers.github) {
          githubText.textContent = "Disconnect GitHub";
          githubBtn.href = "#";
          githubBtn.classList.remove("bg-slate-100", "text-slate-900");
          githubBtn.classList.add("bg-red-600", "text-white");
          githubBtn.onclick = e => {
            e.preventDefault();
            disconnect("github");
          };
        }

        if (providers.google) {
          googleText.textContent = "Disconnect Google";
          googleBtn.href = "#";
          googleBtn.classList.remove("bg-white", "text-slate-900");
          googleBtn.classList.add("bg-red-600", "text-white");
          googleBtn.onclick = e => {
            e.preventDefault();
            disconnect("google");
          };
        }

      } catch (e) {
        console.error(e);
      }
    }

    loadUser();
  </script>

</body>
</html>
